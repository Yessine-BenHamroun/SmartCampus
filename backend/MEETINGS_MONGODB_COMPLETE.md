# üé• Syst√®me de Visioconf√©rence - MongoDB Backend

## ‚úÖ IMPL√âMENTATION COMPL√àTE

Le syst√®me de visioconf√©rence utilise maintenant **MongoDB avec l'architecture du backend** !

---

## üèóÔ∏è Architecture Backend

### Structure cr√©√©e

```
backend/meetings/
‚îú‚îÄ‚îÄ __init__.py           ‚úÖ Module initialization
‚îú‚îÄ‚îÄ models.py             ‚úÖ MongoDB models (Meeting + MeetingParticipant)
‚îú‚îÄ‚îÄ views.py              ‚úÖ API REST avec DRF
‚îú‚îÄ‚îÄ urls.py               ‚úÖ Routes API
‚îî‚îÄ‚îÄ MEETINGS_API.md       ‚úÖ Documentation compl√®te
```

### Int√©gration

```python
# backend/config/urls.py
urlpatterns = [
    ...
    path('api/meetings/', include('meetings.urls')),  # ‚úÖ Ajout√©
]
```

---

## üìä Mod√®les MongoDB

### 1. Meeting Model
```python
class Meeting:
    COLLECTION_NAME = 'meetings'
    
    # Fields
    - _id (ObjectId)
    - meeting_id (UUID) - Unique identifier for Jitsi
    - title (string)
    - description (string)
    - instructor_id (ObjectId) - Reference to users collection
    - instructor_email (string)
    - scheduled_date (datetime)
    - duration (int) - minutes
    - meeting_link (string) - Auto-generated Jitsi URL
    - status (enum) - scheduled, ongoing, completed, cancelled
    - started_at (datetime|null)
    - ended_at (datetime|null)
    - created_at (datetime)
    - updated_at (datetime)
```

**M√©thodes** :
- `create(**kwargs)` - Cr√©er une r√©union
- `find_by_id(meeting_id)` - Trouver par ID
- `find_by_instructor(instructor_id)` - R√©unions d'un instructeur
- `update(meeting_id, **kwargs)` - Modifier
- `delete(meeting_id)` - Annuler (soft delete)
- `start_meeting(meeting_id)` - D√©marrer
- `end_meeting(meeting_id)` - Terminer

### 2. MeetingParticipant Model
```python
class MeetingParticipant:
    COLLECTION_NAME = 'meeting_participants'
    
    # Fields
    - _id (ObjectId)
    - meeting_id (ObjectId) - Reference to meetings
    - student_id (ObjectId) - Reference to users
    - student_email (string)
    - status (enum) - invited, accepted, declined, attended, absent
    - joined_at (datetime|null)
    - left_at (datetime|null)
    - created_at (datetime)
    - updated_at (datetime)
```

**M√©thodes** :
- `create(**kwargs)` - Ajouter participant
- `find_by_meeting(meeting_id)` - Participants d'une r√©union
- `find_by_student(student_id)` - R√©unions d'un √©tudiant
- `update_status(meeting_id, student_id, status)` - Changer statut
- `mark_attended(meeting_id, student_id)` - Marquer pr√©sent
- `mark_left(meeting_id, student_id)` - Marquer sorti
- `get_duration(meeting_id, student_id)` - Calculer dur√©e

---

## üîê V√©rification du r√¥le

### Dans les vues
```python
@api_view(['POST'])
@permission_classes([IsAuthenticated])
def meeting_create(request):
    user_role = request.user.get('role', 'student')
    
    # Only instructors can create meetings
    if user_role != 'instructor':
        return Response({
            'success': False,
            'error': 'Only instructors can create meetings'
        }, status=403)
    
    # Create meeting...
```

### Permissions

| Action | Student (`role='student'`) | Instructor (`role='instructor'`) |
|--------|---------------------------|----------------------------------|
| Cr√©er r√©union | ‚ùå | ‚úÖ |
| Voir ses r√©unions | ‚úÖ (invitations) | ‚úÖ (cr√©√©es) |
| Modifier r√©union | ‚ùå | ‚úÖ (ses r√©unions) |
| Annuler r√©union | ‚ùå | ‚úÖ (ses r√©unions) |
| D√©marrer r√©union | ‚ùå | ‚úÖ (ses r√©unions) |
| Terminer r√©union | ‚ùå | ‚úÖ (ses r√©unions) |
| Rejoindre r√©union | ‚úÖ (si invit√©) | ‚úÖ (ses r√©unions) |
| Accepter/Refuser | ‚úÖ (si invit√©) | N/A |

---

## üåê API Endpoints

### Base URL
```
http://localhost:8001/api/meetings/
```

### Endpoints principaux

1. **`GET /api/meetings/`** - Liste des r√©unions
   - Instructeur : Ses r√©unions cr√©√©es
   - √âtudiant : Ses invitations

2. **`POST /api/meetings/`** - Cr√©er r√©union (instructeur uniquement)
   ```json
   {
     "title": "Cours Python",
     "description": "...",
     "scheduled_date": "2025-11-01T14:00:00",
     "duration": 60,
     "student_ids": ["id1", "id2"]
   }
   ```

3. **`GET /api/meetings/<id>/`** - D√©tails r√©union

4. **`PUT /api/meetings/<id>/`** - Modifier r√©union (instructeur)

5. **`DELETE /api/meetings/<id>/`** - Annuler r√©union (instructeur)

6. **`POST /api/meetings/<id>/start/`** - D√©marrer (instructeur)

7. **`POST /api/meetings/<id>/end/`** - Terminer (instructeur)

8. **`POST /api/meetings/<id>/join/`** - Rejoindre

9. **`POST /api/meetings/<id>/leave/`** - Quitter

10. **`POST /api/meetings/<id>/respond/`** - Accepter/Refuser
    ```json
    { "action": "accept" }  // or "decline"
    ```

11. **`GET /api/meetings/my/invitations/`** - Invitations √©tudiant

---

## üîÑ Workflow complet

### 1. Instructeur cr√©e r√©union
```bash
POST /api/meetings/
Authorization: Bearer <instructor_token>
{
  "title": "Machine Learning Basics",
  "scheduled_date": "2025-11-02T10:00:00",
  "duration": 90,
  "student_ids": ["student_id_1", "student_id_2"]
}

# R√©ponse
{
  "success": true,
  "meeting": {
    "id": "...",
    "meeting_link": "https://meet.jit.si/SmartCampus-<uuid>"
  }
}
```

### 2. √âtudiant voit invitation
```bash
GET /api/meetings/my/invitations/
Authorization: Bearer <student_token>

# R√©ponse
{
  "meetings": [
    {
      "id": "...",
      "title": "Machine Learning Basics",
      "participant_status": "invited"
    }
  ]
}
```

### 3. √âtudiant accepte
```bash
POST /api/meetings/<id>/respond/
{
  "action": "accept"
}

# Status devient "accepted"
```

### 4. Instructeur d√©marre
```bash
POST /api/meetings/<id>/start/

# Status devient "ongoing"
```

### 5. √âtudiant rejoint
```bash
POST /api/meetings/<id>/join/

# R√©ponse
{
  "meeting_link": "https://meet.jit.si/SmartCampus-<uuid>"
}

# Participant status devient "attended"
# joined_at enregistr√©
```

### 6. Instructeur termine
```bash
POST /api/meetings/<id>/end/

# Status devient "completed"
# ended_at enregistr√©
```

---

## üíæ Collections MongoDB

### `meetings`
Stocke toutes les r√©unions.

**Index recommand√©s** :
```javascript
db.meetings.createIndex({ instructor_id: 1, status: 1 })
db.meetings.createIndex({ scheduled_date: 1 })
db.meetings.createIndex({ meeting_id: 1 })
```

### `meeting_participants`
Stocke les participants et leur pr√©sence.

**Index recommand√©s** :
```javascript
db.meeting_participants.createIndex({ meeting_id: 1 })
db.meeting_participants.createIndex({ student_id: 1 })
db.meeting_participants.createIndex({ meeting_id: 1, student_id: 1 }, { unique: true })
```

---

## üîó Connexion Frontend ‚Üî Backend

### Configuration Frontend
```javascript
// Dans le frontend
const API_URL = 'http://localhost:8001/api/meetings/'

// Cr√©er r√©union (instructeur)
fetch(API_URL, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    title: 'Cours Python',
    scheduled_date: '2025-11-01T14:00:00',
    duration: 60,
    student_ids: ['id1', 'id2']
  })
})
```

### CORS Configuration
```python
# backend/config/settings.py
CORS_ALLOWED_ORIGINS = [
    'http://localhost:8000',  # Frontend
    'http://127.0.0.1:8000',
]
```

---

## üß™ Tests

### 1. Cr√©er utilisateur instructeur
```bash
POST http://localhost:8001/api/users/register/
{
  "email": "prof@test.com",
  "username": "prof1",
  "password": "password123",
  "role": "instructor"
}
```

### 2. Cr√©er √©tudiants
```bash
POST http://localhost:8001/api/users/register/
{
  "email": "student1@test.com",
  "username": "student1",
  "password": "password123",
  "role": "student"
}
```

### 3. Login instructeur
```bash
POST http://localhost:8001/api/users/login/
{
  "email": "prof@test.com",
  "password": "password123"
}

# R√©cup√©rer le token
```

### 4. Cr√©er r√©union
```bash
POST http://localhost:8001/api/meetings/
Authorization: Bearer <instructor_token>
{
  "title": "Test Meeting",
  "scheduled_date": "2025-11-01T14:00:00",
  "duration": 60,
  "student_ids": ["<student_id>"]
}
```

### 5. Login √©tudiant et voir invitations
```bash
POST http://localhost:8001/api/users/login/
{
  "email": "student1@test.com",
  "password": "password123"
}

GET http://localhost:8001/api/meetings/my/invitations/
Authorization: Bearer <student_token>
```

---

## üìù Diff√©rences avec le frontend principal

### Frontend SmartCampus (port 8000)
- Utilise Django templates
- Base de donn√©es : SQLite pour auth, MongoDB pour chat
- Interface utilisateur compl√®te

### Backend API (port 8001)
- API REST pure avec DRF
- MongoDB pour tout (users, courses, meetings)
- Pas de templates, seulement JSON

### Solution hybride possible
1. **Frontend** appelle **Backend API** pour les meetings
2. Frontend affiche les donn√©es via AJAX/fetch
3. Authentification partag√©e via JWT

---

## üéØ Avantages architecture MongoDB

‚úÖ **Flexibilit√©** : Sch√©ma JSON flexible
‚úÖ **Performance** : Requ√™tes rapides avec index
‚úÖ **Scalabilit√©** : Facile √† scaler horizontalement
‚úÖ **Coh√©rence** : Architecture backend coh√©rente (tout en MongoDB)
‚úÖ **Int√©gration** : Facile √† int√©grer avec chat existant

---

## üöÄ Prochaines √©tapes

### Option 1 : Frontend pur Django (actuel)
Garder le syst√®me meetings dans le frontend principal avec SQLite.

**Avantages** :
- D√©j√† impl√©ment√© et fonctionnel
- Interface compl√®te avec templates
- Pas besoin d'API calls

**Inconv√©nients** :
- Base de donn√©es diff√©rente (SQLite vs MongoDB)
- Pas de coh√©rence avec le backend

### Option 2 : Migrer vers backend API
Utiliser le backend MongoDB et faire des appels API depuis le frontend.

**Avantages** :
- Architecture coh√©rente (tout en MongoDB)
- API r√©utilisable (apps mobiles, etc.)
- S√©paration frontend/backend

**Inconv√©nients** :
- Besoin de r√©√©crire frontend en AJAX/fetch
- Plus complexe √† maintenir
- CORS √† g√©rer

### Option 3 : Hybride (recommand√©)
- Backend API pour la logique m√©tier
- Frontend pour l'UI et l'affichage
- Communication via API calls

---

## üìñ Documentation compl√®te

Voir **`MEETINGS_API.md`** pour la documentation compl√®te de l'API.

---

## ‚úÖ R√âSUM√â

üéØ **Syst√®me cr√©√© avec succ√®s** :
- ‚úÖ Mod√®les MongoDB (Meeting + MeetingParticipant)
- ‚úÖ API REST compl√®te (11 endpoints)
- ‚úÖ V√©rification du r√¥le (`role='instructor'`)
- ‚úÖ Permissions correctes
- ‚úÖ Documentation API compl√®te
- ‚úÖ Integration avec architecture backend existante

**L'instructeur est bien celui qui cr√©e les r√©unions !** üéâ
