{% extends 'learner/base.html' %}
{% load static %}

{% block title %}My Learning - SmartCampus{% endblock %}

{% block body_class %}my-learning-page{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header section light-background">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8" data-aos="fade-up">
        <h1>My Learning Dashboard</h1>
        <p>Track your enrolled courses and continue your learning journey</p>
      </div>
      <div class="col-lg-4 text-end" data-aos="fade-up" data-aos-delay="100">
        <a href="{% url 'courses' %}" class="btn btn-primary">
          <i class="bi bi-plus-circle"></i> Browse More Courses
        </a>
      </div>
    </div>
  </div>
</section>

<!-- My Courses Section -->
<section class="my-courses section">
  <div class="container">
    
    <!-- Stats Overview -->
    <div class="row mb-5" data-aos="fade-up">
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-book"></i>
          </div>
          <div class="stat-content">
            <h3>{{ enrolled_courses|length }}</h3>
            <p>Enrolled Courses</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{% for course in enrolled_courses %}{% if course.progress == 100 %}1{% endif %}{% endfor %}0</h3>
            <p>Completed Courses</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-clock-history"></i>
          </div>
          <div class="stat-content">
            <h3>{% for course in enrolled_courses %}{% if course.progress > 0 and course.progress < 100 %}1{% endif %}{% endfor %}0</h3>
            <p>In Progress</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-trophy"></i>
          </div>
          <div class="stat-content">
            <h3>0</h3>
            <p>Certificates Earned</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Course List -->
    <div class="row" data-aos="fade-up" data-aos-delay="100">
      <div class="col-12">
        <h2 class="mb-4">My Enrolled Courses</h2>
        
        {% if enrolled_courses %}
          <div class="row">
            {% for course in enrolled_courses %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="learning-card">
                <div class="course-thumbnail">
                  {% if course.thumbnail %}
                    <img src="{{ course.thumbnail }}" alt="{{ course.title }}" class="img-fluid">
                  {% else %}
                    <img src="{% static 'img/education/courses-3.webp' %}" alt="{{ course.title }}" class="img-fluid">
                  {% endif %}
                  <div class="progress-overlay">
                    <div class="progress">
                      <div class="progress-bar" role="progressbar" style="width: {{ course.progress|default:0 }}%" 
                           aria-valuenow="{{ course.progress|default:0 }}" aria-valuemin="0" aria-valuemax="100">
                        {{ course.progress|default:0 }}%
                      </div>
                    </div>
                  </div>
                </div>
                <div class="learning-card-body">
                  <h5>{{ course.title }}</h5>
                  <p class="text-muted small">{{ course.description|truncatewords:15 }}</p>
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <span class="badge bg-primary">{{ course.category|title }}</span>
                    <span class="text-muted small">
                      <i class="bi bi-clock"></i> {{ course.duration_hours|default:0 }}h
                    </span>
                  </div>
                  <a href="{% url 'course_detail' course.id %}" class="btn btn-sm btn-outline-primary w-100">
                    <i class="bi bi-play-circle"></i> Continue Learning
                  </a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state text-center py-5">
            <i class="bi bi-book display-1 text-muted mb-3"></i>
            <h3>No Enrolled Courses Yet</h3>
            <p class="text-muted mb-4">Start your learning journey by enrolling in courses that interest you.</p>
            <a href="{% url 'courses' %}" class="btn btn-primary">
              <i class="bi bi-search"></i> Explore Courses
            </a>
          </div>
        {% endif %}
      </div>
    </div>

  </div>
</section>

<style>
.stat-card {
  background: white;
  border-radius: 10px;
  padding: 25px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  gap: 15px;
  transition: transform 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-icon {
  font-size: 2.5rem;
  color: var(--accent-color);
}

.stat-content h3 {
  font-size: 2rem;
  font-weight: bold;
  margin: 0;
  color: var(--heading-color);
}

.stat-content p {
  margin: 0;
  color: var(--default-color);
}

.empty-state {
  background: white;
  border-radius: 10px;
  padding: 60px 20px;
}

.learning-card {
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}

.learning-card:hover {
  transform: translateY(-5px);
}

.course-thumbnail {
  position: relative;
  overflow: hidden;
}

.course-thumbnail img {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.progress-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 10px;
  background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
}

.progress-overlay .progress {
  height: 8px;
  background: rgba(255,255,255,0.3);
}

.progress-overlay .progress-bar {
  background: var(--accent-color);
  font-size: 0.7rem;
  line-height: 8px;
}

.learning-card-body {
  padding: 20px;
}

.learning-card-body h5 {
  margin-bottom: 10px;
  color: var(--heading-color);
}
</style>
{% endblock %}
